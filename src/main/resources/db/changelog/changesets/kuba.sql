-- liquibase formatted sql

-- changeset Kuba:1729952375256-1
CREATE TABLE CONVERSATION (conversationId INT NOT NULL, CONSTRAINT CONVERSATIONPK PRIMARY KEY (conversationId));

-- changeset Kuba:1729952375256-2
CREATE TABLE CONVERSATION_USER (conversationId INT NOT NULL, userId INT NOT NULL, conversation_id INT NOT NULL, user_id INT NOT NULL, CONSTRAINT CONVERSATION_USERPK PRIMARY KEY (conversationId, userId));

-- changeset Kuba:1729952375256-3
CREATE TABLE MESSAGE (messageId INT AUTO_INCREMENT NOT NULL, receiver_id INT NOT NULL, sender_id INT NOT NULL, CONSTRAINT MESSAGEPK PRIMARY KEY (messageId));

-- changeset Kuba:1729952375256-4
CREATE TABLE PUBLIC_KEY (publicKeyId INT AUTO_INCREMENT NOT NULL, creationDate datetime(6) NULL, fingerprint VARCHAR(255) NULL, `key` VARCHAR(255) NULL, valid BIT NULL, owner_id INT NOT NULL, CONSTRAINT PUBLIC_KEYPK PRIMARY KEY (publicKeyId));

-- changeset Kuba:1729952375256-5
CREATE TABLE RESET_TOKEN (resetTokenId INT AUTO_INCREMENT NOT NULL, expirationDate datetime(6) NULL, token VARCHAR(255) NULL, user_userId INT NULL, CONSTRAINT RESET_TOKENPK PRIMARY KEY (resetTokenId));

-- changeset Kuba:1729952375256-7
CREATE TABLE USER (userId INT AUTO_INCREMENT NOT NULL, email VARCHAR(255) NULL, hashedPassword VARCHAR(255) NULL, salt VARCHAR(255) NULL, username VARCHAR(255) NULL, CONSTRAINT USERPK PRIMARY KEY (userId));

-- changeset Kuba:1729952375256-8
CREATE TABLE USER_CONTACT (USER_ID INT NOT NULL, CONTACT_USER_ID INT NOT NULL);

-- changeset Kuba:1729952375256-9
ALTER TABLE PUBLIC_KEY ADD CONSTRAINT FK85qcsnhq5xx6l4n5kga3mdeh0 FOREIGN KEY (owner_id) REFERENCES USER (userId);

-- changeset Kuba:1729952375256-10
ALTER TABLE RESET_TOKEN ADD CONSTRAINT FKdvihxa886stkutdp2yjka3mn0 FOREIGN KEY (user_userId) REFERENCES USER (userId);

-- changeset Kuba:1729952375256-11
ALTER TABLE MESSAGE ADD CONSTRAINT FKfg8omticr9rpbyikv2g4tc6sw FOREIGN KEY (sender_id) REFERENCES USER (userId);

-- changeset Kuba:1729952375256-12
ALTER TABLE CONVERSATION_USER ADD CONSTRAINT FKg8ig39uy9j27tlnv81c2p2dee FOREIGN KEY (conversation_id) REFERENCES CONVERSATION (conversationId);

-- changeset Kuba:1729952375256-13
ALTER TABLE USER_CONTACT ADD CONSTRAINT FKj3np7d2obo6cj32u99yvq4cvr FOREIGN KEY (USER_ID) REFERENCES USER (userId);

-- changeset Kuba:1729952375256-14
ALTER TABLE MESSAGE ADD CONSTRAINT FKjj6ikosoylvp15tpkrnbv4pgq FOREIGN KEY (receiver_id) REFERENCES USER (userId);

-- changeset Kuba:1729952375256-15
ALTER TABLE USER_CONTACT ADD CONSTRAINT FKpqiosmeeaclfod4ql00utld0g FOREIGN KEY (CONTACT_USER_ID) REFERENCES USER (userId);

-- changeset Kuba:1729952375256-16
ALTER TABLE CONVERSATION_USER ADD CONSTRAINT FKt6p5xaia5k6rkdu1hqto5x0qb FOREIGN KEY (user_id) REFERENCES USER (userId);